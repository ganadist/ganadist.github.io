
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://ganadist.github.io/theme/stylesheet/style.min.css">


    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
          href="https://ganadist.github.io/theme/pygments/github.min.css">


  <link rel="stylesheet" type="text/css" href="https://ganadist.github.io/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://ganadist.github.io/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://ganadist.github.io/theme/font-awesome/css/solid.css">


    <link href="https://ganadist.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ganachoco's Blog Atom">



<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-120269954-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->  


 

<meta name="author" content="YOUNG HO CHA" />
<meta name="description" content="Java 21에서 안드로이드 앱 빌드하기" />
<meta name="keywords" content="Java, Android, Gradle, Kotlin">


  <meta property="og:site_name" content="Ganachoco's Blog"/>
  <meta property="og:title" content="Android App Build with Java 21"/>
  <meta property="og:description" content="Java 21에서 안드로이드 앱 빌드하기"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://ganadist.github.io/2023_11_02_android_build_java_21.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2023-11-02 22:35:00+09:00"/>
  <meta property="article:modified_time" content=""/>
  <meta property="article:author" content="https://ganadist.github.io/author/young-ho-cha.html">
  <meta property="article:section" content="tech"/>
  <meta property="article:tag" content="Java"/>
  <meta property="article:tag" content="Android"/>
  <meta property="article:tag" content="Gradle"/>
  <meta property="article:tag" content="Kotlin"/>
  <meta property="og:image" content="">

  <title>Ganachoco's Blog &ndash; Android App Build with Java 21</title>

</head>
<body class="light-theme">
  <aside>
    <div>
      <a href="https://ganadist.github.io/">
        <img src="https://ganadist.github.io/theme/img/profile.png" alt="" title="">
      </a>

      <h1>
        <a href="https://ganadist.github.io/"></a>
      </h1>



      <nav>
        <ul class="list">



            <li>
              <a target="_self" href="http://b.android.com" >b.android.com</a>
            </li>
            <li>
              <a target="_self" href="https://d.android.com" >d.android.com</a>
            </li>
            <li>
              <a target="_self" href="https://r.android.com" >r.android.com</a>
            </li>
            <li>
              <a target="_self" href="https://s.android.com" >s.android.com</a>
            </li>
            <li>
              <a target="_self" href="https://shop.deadzebra.com/andy-green-edition-by-android-foundry/" >Andy Figure</a>
            </li>
        </ul>
      </nav>

      <ul class="social">
          <li>
            <a  class="sc-github" href="http://github.com/ganadist" target="_blank">
              <i class="fab fa-github"></i>
            </a>
          </li>
          <li>
            <a  class="sc-slideshare" href="https://www.slideshare.net/ganachoco/presentations" target="_blank">
              <i class="fab fa-slideshare"></i>
            </a>
          </li>
          <li>
            <a  class="sc-linkedin" href="http://www.linkedin.com/in/ganadist" target="_blank">
              <i class="fab fa-linkedin"></i>
            </a>
          </li>
      </ul>
    </div>

  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="2023_11_02_android_build_java_21">Android App Build with Java&nbsp;21</h1>
    <p>
      Posted on 11/02/2023 in <a href="https://ganadist.github.io/category/tech.html">tech</a>

    </p>
  </header>


  <div>
    <h1>시작하면서</h1>
<p>2023년 9월 19일에 Java 21이 출시되었습니다.
Java 17이 2021년 9월에 나왔었는데, <a href="https://blog.jetbrains.com/idea/2022/07/intellij-idea-2022-2/#key-updates">IntelliJ 2022.2.1 부터 Java 17이 기본 탑재</a>되기 시작했고, <a href="https://developer.android.com/studio/releases/past-releases/as-flamingo-release-notes#jdk-17">Android Studio 2022.2.1도 따라서 Java 17을 탑재해서 출시</a>되었습니다.</p>
<p>Java 21은 Java 17에 이은 <a href="https://www.oracle.com/kr/java/technologies/java-se-support-roadmap.html"><span class="caps">LTS</span>(Long Term Support)버젼</a>으로 관리가 될텐데요. 따라서 IntelliJ 및 Android Studio에서도 <a href="https://github.com/JetBrains/JetBrainsRuntime/tree/jbr21">Java 21</a>이 탑재될 것으로&nbsp;보입니다.</p>
<p>Java 21을 이용해 안드로이드 앱을 빌드하려면 어떠한 준비를 해야하는지&nbsp;살펴보겠습니다.</p>
<h1>빌드도구&nbsp;조합</h1>
<p>먼저 아래 도구의 조합이&nbsp;필요합니다.</p>
<ul>
<li><a href="https://docs.gradle.org/8.4/release-notes.html#support-for-building-projects-with-java-21">Gradle&nbsp;8.4</a></li>
<li><a href="https://kotlinlang.org/docs/whatsnew1920.html#kotlin-jvm">Kotlin&nbsp;1.9.20</a></li>
<li><a href="https://issuetracker.google.com/issues/294137077">Android Gradle Plugin&nbsp;8.3</a></li>
</ul>
<p>이외에 몇가지 조정이&nbsp;필요합니다.</p>
<h2>Java Byte Code&nbsp;Version</h2>
<p>Android Gradle Plugin에서 별다른 설정을 하지 않으면, 앱에서 사용될 Java 소스코드에 대해서는 Java 1.8의 Byte Code를 생성합니다.
하지만 Java 20 이후부터 <a href="https://bugs.openjdk.org/browse/JDK-8173605">Java 1.8의 Byte Code를 생성하는 기능이 Deprecated</a> 되었습니다.
해당 기능을 사용하지 못한다는 것은 아니지만, Java 22부터는 해당 기능이 제거될 예정이기 때문에, <code>Java 11</code>의 Byte Code 생성을 하는 것을 심각하게 고려해야 합니다.
(Java 17의 Byte Code 생성은 아직 Android 빌드 생태계에는 이른 결정이 될 수&nbsp;있습니다.)</p>
<p>그리고 빌드도중에 사용되는 (즉 PC의 Java VM에서 로딩되는) Java Byte Code는 Android Gradle Plugin과 동일한 <code>Java 17</code>로 설정해서 사용하는게, 당분간 좋을&nbsp;것입니다.</p>
<h2>Kotlin의 <span class="caps">JVM</span> Byte Code&nbsp;Version</h2>
<p>Kotlin Compiler에서 생성하는 <span class="caps">JVM</span> Byte Code Version은 위에 설명한 Java Compiler의 Byte Code Version과 일치시켜야&nbsp;합니다.</p>
<p>즉, 앱에서 수행될 코드는 Java 11, PC에서 수행될 코드는 Java 17의 Byte Code를 생성하면&nbsp;됩니다.</p>
<h2><span class="caps">AIDL</span>&nbsp;Compiler</h2>
<p>AIDL은 다른 어플리케이션이나 프로세스에서 수행되는 로직을 제어하기 위한, 인터페이스 정의 언어입니다.
AIDL은 <span class="caps">AIDL</span> Compiler를 통해 Java코드로 변환된 후, 앱에 포함이 되는데요.
<span class="caps">AIDL</span> Compiler에서 생성하는 코드에 대해 Java 21컴파일러는 경고를 표시합니다.<br>
해당 경고는 <code>-Xlint:-this-escape</code> 옵션을 이용해서 끌 수 있습니다.
자세한 사항은 https://issuetracker.google.com/issues/294422895 를 참고하시기&nbsp;바랍니다.</p>
<h2>Android Gradle&nbsp;Plugin</h2>
<p>Android Gradle 8.3 은 현재 Canary 11까지 출시되었으며, 정식버젼이 나오려면 3-4달은 기다려야 합니다.<br>
Java 21에서 안드로이드 플랫폼 API를 참조하는 과정에서 <a href="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jlink.html">jlink라는 도구</a>를 이용하는데, <a href="https://bugs.openjdk.org/browse/JDK-8304913">해당 도구의 동작 사양이 변경</a>되는 바람에 Java 21을 사용하기 어려워 졌는데요.<br>
해당 변경사항에 대한 대응이 <a href="https://android.googlesource.com/platform/tools/base/+/d6e8d6119">Android Gradle Plugin 8.3-alpha03 에 적용</a>되었습니다.
그 이전의 Android Gradle Plugin버젼을 사용하면 오류가 발생되는데, 그렇다고 아직 호환성 문제가 발생할 수 있는 Android Gradle Plugin의 alpha버젼을 도입하는 것도 어려울 가능성이 높습니다.<br>
그래서 이전 Android Gradle Plugin버젼에서 사용할 수 있도록 <a href="https://gist.github.com/ganadist/3e38cfe88fe1346c46ca1ee964e45dd9#file-labs-openjdk-21-diff">jlink를 수정</a>한 <a href="https://github.com/ganadist/graalvm-ce-builds/releases/tag/2023-10-24">JDK를 만들어 보았습니다</a>.</p>
<h2>샘플&nbsp;프로젝트</h2>
<p>https://github.com/ganadist/VersionCodeDemo 는 <a href="https://issuetracker.google.com/issues?q=reporter:ganachoco@linecorp.com">Google 의 이슈트래커에 Android 앱 빌드와 관련된 오류를 공유</a> 할 때 사용하는 repo입니다.
해당 repo의 main branch에 Java 21을 대응할 수 있도록&nbsp;조정해놓았습니다.</p>
<p>혹시라도 Java 21을 Android 앱 빌드시스템에 적용하는 것을 고려하고 있다면, 참고하시기&nbsp;바랍니다.</p>
<ul>
<li>앱에서 사용될 중간코드의 Java Bytecode Version 을 11로 설정<ul>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/gradle.properties#L129">gradle.properties&nbsp;설정</a></li>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/build-logic/convention/src/main/kotlin/AndroidBuilderPlugin.kt#L52-L59">convention plugin 에서 바이트코드&nbsp;설정</a></li>
</ul>
</li>
<li>빌드시스템에서 사용될 코드의 Java Bytecode Version 을 17로 설정<ul>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/gradle.properties#L128">gradle.properties&nbsp;설정</a></li>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/build-logic/build.gradle.kts#L9-L25">convention plugin의 빌드스크립트&nbsp;설정</a></li>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/build-logic/convention/src/main/kotlin/AndroidBuilderPlugin.kt#L82-L88">convention plugin 에서 바이트코드&nbsp;설정</a></li>
</ul>
</li>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/build-logic/convention/src/main/kotlin/com/myapplication/android/builder/Java.kt#L7-L13"><span class="caps">AIDL</span> Compiler&nbsp;설정</a></li>
<li><a href="https://github.com/ganadist/VersionCodeDemo/blob/b80b1c3/gradle/build_requires_checker.gradle#L42-L44">Java 21사용시, Java 버젼에 대한&nbsp;경고</a></li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://ganadist.github.io/tag/java.html">Java</a>
      <a href="https://ganadist.github.io/tag/android.html">Android</a>
      <a href="https://ganadist.github.io/tag/gradle.html">Gradle</a>
      <a href="https://ganadist.github.io/tag/kotlin.html">Kotlin</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'ganadist-github-io';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    Please enable JavaScript to view comments.
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  </p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Ganachoco's Blog ",
  "url" : "https://ganadist.github.io",
  "image": "",
  "description": ""
}
</script>

</body>
</html>